/////////////////////////////////////////////////////////////////////////////
///   File           :            BA_subFunctions.h
///   Description    :
/////////////////////////////////////////////////////////////////////////////

#include "BA_declaration.h"

/*-------------------------------------------------------------------------*/
/*                       Normal Equation                                   */
/*-------------------------------------------------------------------------*/
void normalEquations(jacobian* J)
{
   //Extract the parameters
   int ptId, camId;
   dtype r11, r12, r13, r21, r22, r23, r31, r32, r33, t11, t12, t13, k1, k2, f, x, y, z;

   for (int i = 0; i < num_proj; i++){
      camId = (camidx[i]) * 15; ptId = (num_cam * 15) + ((ptidx[i]) * 3);
      r11 = P[camId]; r12 = P[camId + 1]; r13 = P[camId + 2];
      r21 = P[camId + 3]; r22 = P[camId + 4]; r23 = P[camId + 5];
      r31 = P[camId + 6]; r32 = P[camId + 7]; r33 = P[camId + 8];
      t11 = P[camId + 9]; t12 = P[camId + 10]; t13 = P[camId + 11];
      f = P[camId + 12]; k1 = P[camId + 13]; k2 = P[camId + 14];
      x = P[ptId]; y = P[ptId + 1]; z = P[ptId + 2];

      //Equations
      J[i].Aij[0][0] = (-(f*((2 * k1*x*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + (4 * k2*x*(((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))*(t11 + r11*x + r12*y + r13*z)) / (t13 + r31*x + r32*y + r33*z) - (f*x*(k1*(((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z))) + k2*((((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))*(((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))) + 1)) / (t13 + r31*x + r32*y + r33*z));
      J[i].Aij[0][1] = (-(f*((2 * k1*y*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + (4 * k2*y*(((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))*(t11 + r11*x + r12*y + r13*z)) / (t13 + r31*x + r32*y + r33*z) - (f*y*(k1*(((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z))) + k2*((((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))*(((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))) + 1)) / (t13 + r31*x + r32*y + r33*z));
      J[i].Aij[0][2] = (-(f*((2 * k1*z*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + (4 * k2*z*(((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))*(t11 + r11*x + r12*y + r13*z)) / (t13 + r31*x + r32*y + r33*z) - (f*z*(k1*(((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z))) + k2*((((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))*(((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))) + 1)) / (t13 + r31*x + r32*y + r33*z));
      J[i].Aij[0][3] = (-(f*((2 * k1*x*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + (4 * k2*x*(((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))*(t11 + r11*x + r12*y + r13*z)) / (t13 + r31*x + r32*y + r33*z));
      J[i].Aij[0][4] = (-(f*((2 * k1*y*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + (4 * k2*y*(((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))*(t11 + r11*x + r12*y + r13*z)) / (t13 + r31*x + r32*y + r33*z));
      J[i].Aij[0][5] = (-(f*((2 * k1*z*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + (4 * k2*z*(((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))*(t11 + r11*x + r12*y + r13*z)) / (t13 + r31*x + r32*y + r33*z));
      J[i].Aij[0][6] = ((f*(k1*((2 * x*((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z))) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + (2 * x*((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z))) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z))) + 2 * k2*((2 * x*((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z))) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + (2 * x*((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z))) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))*(((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z))))*(t11 + r11*x + r12*y + r13*z)) / (t13 + r31*x + r32*y + r33*z) + (f*x*(k1*(((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z))) + k2*((((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))*(((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))) + 1)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)));
      J[i].Aij[0][7] = ((f*(k1*((2 * y*((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z))) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + (2 * y*((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z))) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z))) + 2 * k2*((2 * y*((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z))) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + (2 * y*((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z))) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))*(((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z))))*(t11 + r11*x + r12*y + r13*z)) / (t13 + r31*x + r32*y + r33*z) + (f*y*(k1*(((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z))) + k2*((((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))*(((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))) + 1)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)));
      J[i].Aij[0][8] = ((f*(k1*((2 * z*((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z))) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + (2 * z*((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z))) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z))) + 2 * k2*((2 * z*((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z))) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + (2 * z*((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z))) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))*(((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z))))*(t11 + r11*x + r12*y + r13*z)) / (t13 + r31*x + r32*y + r33*z) + (f*z*(k1*(((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z))) + k2*((((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))*(((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))) + 1)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)));
      J[i].Aij[0][9] = (-(f*(k1*(((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z))) + k2*((((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))*(((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))) + 1)) / (t13 + r31*x + r32*y + r33*z) - (f*((k1*(2 * t11 + 2 * r11*x + 2 * r12*y + 2 * r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + (2 * k2*(((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))*(2 * t11 + 2 * r11*x + 2 * r12*y + 2 * r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))*(t11 + r11*x + r12*y + r13*z)) / (t13 + r31*x + r32*y + r33*z));
      J[i].Aij[0][10]= (-(f*((k1*(2 * t12 + 2 * r21*x + 2 * r22*y + 2 * r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + (2 * k2*(((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))*(2 * t12 + 2 * r21*x + 2 * r22*y + 2 * r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))*(t11 + r11*x + r12*y + r13*z)) / (t13 + r31*x + r32*y + r33*z));
      J[i].Aij[0][11]= ((f*(k1*(((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z))) + k2*((((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))*(((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))) + 1)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + (f*(k1*((2 * ((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z))) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + (2 * ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z))) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z))) + 2 * k2*(((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))*((2 * ((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z))) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + (2 * ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z))) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z))))*(t11 + r11*x + r12*y + r13*z)) / (t13 + r31*x + r32*y + r33*z));
      J[i].Aij[0][12]= (-((k1*(((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z))) + k2*((((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))*(((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))) + 1)*(t11 + r11*x + r12*y + r13*z)) / (t13 + r31*x + r32*y + r33*z));
      J[i].Aij[0][13]= (-(f*(((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))*(t11 + r11*x + r12*y + r13*z)) / (t13 + r31*x + r32*y + r33*z));
      J[i].Aij[0][14]= (-(f*((((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))*(((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))) * (t11 + r11*x + r12*y + r13*z)) / (t13 + r31*x + r32*y + r33*z));
      J[i].Bij[0][0] = ((f*r31*(k1*(((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z))) + k2*((((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))*(((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))) + 1)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) - (f*(k1*((2 * r11*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + (2 * r21*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) - (2 * r31*((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z))) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) - (2 * r31*((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z))) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z))) + 2 * k2*(((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))*((2 * r11*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + (2 * r21*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) - (2 * r31*((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z))) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) - (2 * r31*((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z))) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z))))*(t11 + r11*x + r12*y + r13*z)) / (t13 + r31*x + r32*y + r33*z) - (f*r11*(k1*(((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z))) + k2*((((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))*(((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))) + 1)) / (t13 + r31*x + r32*y + r33*z));
      J[i].Bij[0][1] = ((f*r32*(k1*(((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z))) + k2*((((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))*(((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))) + 1)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) - (f*(k1*((2 * r12*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + (2 * r22*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) - (2 * r32*((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z))) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) - (2 * r32*((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z))) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z))) + 2 * k2*(((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))*((2 * r12*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + (2 * r22*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) - (2 * r32*((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z))) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) - (2 * r32*((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z))) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z))))*(t11 + r11*x + r12*y + r13*z)) / (t13 + r31*x + r32*y + r33*z) - (f*r12*(k1*(((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z))) + k2*((((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))*(((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))) + 1)) / (t13 + r31*x + r32*y + r33*z));
      J[i].Bij[0][2] = ((f*r33*(k1*(((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z))) + k2*((((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))*(((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))) + 1)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) - (f*(k1*((2 * r13*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + (2 * r23*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) - (2 * r33*((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z))) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) - (2 * r33*((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z))) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z))) + 2 * k2*(((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))*((2 * r13*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + (2 * r23*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) - (2 * r33*((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z))) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) - (2 * r33*((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z))) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z))))*(t11 + r11*x + r12*y + r13*z)) / (t13 + r31*x + r32*y + r33*z) - (f*r13*(k1*(((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z))) + k2*((((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))*(((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))) + 1)) / (t13 + r31*x + r32*y + r33*z));

      J[i].Aij[1][0] = (-(f*((2 * k1*x*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + (4 * k2*x*(((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))*(t12 + r21*x + r22*y + r23*z)) / (t13 + r31*x + r32*y + r33*z));
      J[i].Aij[1][1] = (-(f*((2 * k1*y*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + (4 * k2*y*(((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))*(t12 + r21*x + r22*y + r23*z)) / (t13 + r31*x + r32*y + r33*z));
      J[i].Aij[1][2] = (-(f*((2 * k1*z*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + (4 * k2*z*(((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))*(t12 + r21*x + r22*y + r23*z)) / (t13 + r31*x + r32*y + r33*z));
      J[i].Aij[1][3] = (-(f*((2 * k1*x*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + (4 * k2*x*(((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))*(t12 + r21*x + r22*y + r23*z)) / (t13 + r31*x + r32*y + r33*z) - (f*x*(k1*(((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z))) + k2*((((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))*(((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))) + 1)) / (t13 + r31*x + r32*y + r33*z));
      J[i].Aij[1][4] = (-(f*((2 * k1*y*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + (4 * k2*y*(((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))*(t12 + r21*x + r22*y + r23*z)) / (t13 + r31*x + r32*y + r33*z) - (f*y*(k1*(((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z))) + k2*((((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))*(((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))) + 1)) / (t13 + r31*x + r32*y + r33*z));
      J[i].Aij[1][5] = (-(f*((2 * k1*z*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + (4 * k2*z*(((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))*(t12 + r21*x + r22*y + r23*z)) / (t13 + r31*x + r32*y + r33*z) - (f*z*(k1*(((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z))) + k2*((((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))*(((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))) + 1)) / (t13 + r31*x + r32*y + r33*z));
      J[i].Aij[1][6] = ((f*(k1*((2 * x*((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z))) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + (2 * x*((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z))) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z))) + 2 * k2*((2 * x*((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z))) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + (2 * x*((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z))) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))*(((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z))))*(t12 + r21*x + r22*y + r23*z)) / (t13 + r31*x + r32*y + r33*z) + (f*x*(k1*(((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z))) + k2*((((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))*(((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))) + 1)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)));
      J[i].Aij[1][7] = ((f*(k1*((2 * y*((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z))) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + (2 * y*((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z))) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z))) + 2 * k2*((2 * y*((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z))) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + (2 * y*((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z))) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))*(((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z))))*(t12 + r21*x + r22*y + r23*z)) / (t13 + r31*x + r32*y + r33*z) + (f*y*(k1*(((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z))) + k2*((((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))*(((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))) + 1)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)));
      J[i].Aij[1][8] = ((f*(k1*((2 * z*((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z))) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + (2 * z*((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z))) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z))) + 2 * k2*((2 * z*((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z))) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + (2 * z*((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z))) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))*(((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z))))*(t12 + r21*x + r22*y + r23*z)) / (t13 + r31*x + r32*y + r33*z) + (f*z*(k1*(((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z))) + k2*((((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))*(((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))) + 1)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)));
      J[i].Aij[1][9] = (-(f*((k1*(2 * t11 + 2 * r11*x + 2 * r12*y + 2 * r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + (2 * k2*(((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))*(2 * t11 + 2 * r11*x + 2 * r12*y + 2 * r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))*(t12 + r21*x + r22*y + r23*z)) / (t13 + r31*x + r32*y + r33*z));
      J[i].Aij[1][10]= (-(f*(k1*(((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z))) + k2*((((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))*(((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))) + 1)) / (t13 + r31*x + r32*y + r33*z) - (f*((k1*(2 * t12 + 2 * r21*x + 2 * r22*y + 2 * r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + (2 * k2*(((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))*(2 * t12 + 2 * r21*x + 2 * r22*y + 2 * r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))*(t12 + r21*x + r22*y + r23*z)) / (t13 + r31*x + r32*y + r33*z));
      J[i].Aij[1][11]= ((f*(k1*(((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z))) + k2*((((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))*(((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))) + 1)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + (f*(k1*((2 * ((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z))) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + (2 * ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z))) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z))) + 2 * k2*(((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))*((2 * ((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z))) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + (2 * ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z))) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z))))*(t12 + r21*x + r22*y + r23*z)) / (t13 + r31*x + r32*y + r33*z));
      J[i].Aij[1][12]= (-((k1*(((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z))) + k2*((((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))*(((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))) + 1)*(t12 + r21*x + r22*y + r23*z)) / (t13 + r31*x + r32*y + r33*z));
      J[i].Aij[1][13]= (-(f*(((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))*(t12 + r21*x + r22*y + r23*z)) / (t13 + r31*x + r32*y + r33*z));
      J[i].Aij[1][14]= (-(f*((((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))*(((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))) * (t12 + r21*x + r22*y + r23*z)) / (t13 + r31*x + r32*y + r33*z));
      J[i].Bij[1][0] = ((f*r31*(k1*(((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z))) + k2*((((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))*(((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))) + 1)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) - (f*(k1*((2 * r11*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + (2 * r21*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) - (2 * r31*((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z))) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) - (2 * r31*((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z))) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z))) + 2 * k2*(((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))*((2 * r11*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + (2 * r21*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) - (2 * r31*((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z))) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) - (2 * r31*((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z))) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z))))*(t12 + r21*x + r22*y + r23*z)) / (t13 + r31*x + r32*y + r33*z) - (f*r21*(k1*(((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z))) + k2*((((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))*(((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))) + 1)) / (t13 + r31*x + r32*y + r33*z));
      J[i].Bij[1][1] = ((f*r32*(k1*(((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z))) + k2*((((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))*(((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))) + 1)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) - (f*(k1*((2 * r12*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + (2 * r22*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) - (2 * r32*((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z))) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) - (2 * r32*((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z))) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z))) + 2 * k2*(((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))*((2 * r12*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + (2 * r22*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) - (2 * r32*((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z))) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) - (2 * r32*((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z))) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z))))*(t12 + r21*x + r22*y + r23*z)) / (t13 + r31*x + r32*y + r33*z) - (f*r22*(k1*(((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z))) + k2*((((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))*(((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))) + 1)) / (t13 + r31*x + r32*y + r33*z));
      J[i].Bij[1][2] = ((f*r33*(k1*(((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z))) + k2*((((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))*(((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))) + 1)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) - (f*(k1*((2 * r13*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + (2 * r23*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) - (2 * r33*((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z))) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) - (2 * r33*((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z))) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z))) + 2 * k2*(((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))*((2 * r13*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + (2 * r23*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) - (2 * r33*((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z))) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) - (2 * r33*((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z))) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z))))*(t12 + r21*x + r22*y + r23*z)) / (t13 + r31*x + r32*y + r33*z) - (f*r23*(k1*(((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z))) + k2*((((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))*(((t11 + r11*x + r12*y + r13*z)*(t11 + r11*x + r12*y + r13*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)) + ((t12 + r21*x + r22*y + r23*z)*(t12 + r21*x + r22*y + r23*z)) / ((t13 + r31*x + r32*y + r33*z)*(t13 + r31*x + r32*y + r33*z)))) + 1)) / (t13 + r31*x + r32*y + r33*z));


      /*if (i == 10){
         cout << J[i].Aij[0][0] << "\t" << J[i].Bij[1][1] << endl;
      }*/
   }
}

/*-------------------------------------------------------------------------*/
/*                      Initiaize U, V and W with zeros                    */
/*-------------------------------------------------------------------------*/
void zeroInitialization()
{
   //U initialization
   for(int i=0;i<(num_cam*225);i++){
      U[i]=0.0;
   }

   //V initialization
   for(int i=0;i<(num_pt*9);i++){
      V[i]=0.0;
   }

   //W initialization
   for(int i=0;i<(num_proj*45);i++){
      valW[i]=0.0;
   }
/*   for(int i=0;i<(num_cam+1);i++){
      rowPtrW[i]=0;
   }
*/
   //b initialization
   for(int i=0;i<((num_cam*15)+(num_pt*3));i++){
      b[i]=0;
   }
}

/*-------------------------------------------------------------------------*/
/*                     Calculate U, V and W                                */
/*-------------------------------------------------------------------------*/
void calculateUVW(jacobian* J)
{
   int ptId, camId;
//   rowPtrW[0]=0;

   for(int i=0;i<num_proj;i++){
      ptId = ptidx[i]; camId = camidx[i];

      //Calculate U = A'A; 15*15
      matMulU(J[i].Aij, (camId*225));

      //Calculate V = B'B; 3*3
      matMulV(J[i].Bij, (ptId*9));

      //Calculate W = A'B; 15*3
      matMulW(J[i].Aij,J[i].Bij,(i*45));

//      rowPtrW[camId+1]=rowPtrW[camId+1]+1;
   }

/*   //Print to check number of points in each camera
   for(int i=0;i<(num_cam+1);i++){
      cout<<"cam "<<i<<" = "<<rowPtrW[i]<<endl;
   }
*/

/*   //Compute rowPtrW
   for(int i=1;i<(num_cam+1);i++){
      rowPtrW[i]=rowPtrW[i]+rowPtrW[i-1];
   }
*/
/*   //Print to check number of points in each camera
   for(int i=0;i<(num_cam+1);i++){
      cout<<"cam "<<i<<" = "<<rowPtrW[i]<<endl;
   }
*/

}

/*-------------------------------------------------------------------------*/
/*                          Calculate b                                    */
/*-------------------------------------------------------------------------*/
void calculateb(jacobian* J)
{
   for (int i = 0; i < num_proj; i++){
      //Calculate Ea = A' * eij;15*1
      matMulEa(J[i].Aij, i);

      //Calculate Eb = B' * eij;3*1
      matMulEb(J[i].Bij, i);
   }
}

/*-------------------------------------------------------------------------*/
/*                        Calculate stopping criteria                      */
/*-------------------------------------------------------------------------*/
bool criteria()
{
   //dtype e1 = pow(10, -12);
   for (int i = 0; i < ((num_cam * 15) + (num_pt * 3)); i++){
      if (b[i]>e1) return 0;
   }

   return 1;
}

/*-------------------------------------------------------------------------*/
/*                        Damping term                                     */
/*-------------------------------------------------------------------------*/
dtype maxUDiagonal()
{
   dtype maxU; int Id;
   maxU = U[0];

   for (int i = 0; i < num_cam; i++){
      for (int j = 0; j < 15; j++){
         Id = (i * 225) + (16 * j);
         if (maxU < U[Id]){
            maxU = U[Id];
         }
      }
   }

   return maxU;
}

dtype maxVDiagonal()
{
   dtype maxV; int Id;
   maxV = V[0];
   for (int i = 0; i < num_pt; i++){
      for (int j = 0; j < 3; j++){
         Id = (i * 9) + (4 * j);
            if (maxV < V[Id]){
               maxV = V[Id];
            }
         }
   }

   return maxV;
}

/*-------------------------------------------------------------------------*/
/*                          Delta Initialization                           */
/*-------------------------------------------------------------------------*/
void deltaInitialization()
{
   int totalSize = (num_cam*15)+(num_pt*3);

   //Initialize to 0
   for(int i=0;i<totalSize;i++){
      delta[i]=0.0;
   }
}

/*-------------------------------------------------------------------------*/
/*                              rk = b                                     */
/*-------------------------------------------------------------------------*/
void rkEqualsb(dtype* rk)
{
   int totalSize = (num_cam*15)+(num_pt*3);

   for(int i=0;i<totalSize;i++){
      rk[i] = b[i];
   }
}

/*-------------------------------------------------------------------------*/
/*                  Compute zk = M^-1 * rk                                 */
/*-------------------------------------------------------------------------*/
void computezk(dtype* zk, dtype* rk)
{
   int totalSize = (num_cam*15)+(num_pt*3);

   for(int i=0;i<totalSize;i++){
      zk[i] = M[i] * rk[i];
   }
}

/*-------------------------------------------------------------------------*/
/*                              pk = zk                                    */
/*-------------------------------------------------------------------------*/
void pkEqualszk(dtype* pk, dtype* zk)
{
   int totalSize = (num_cam*15)+(num_pt*3);

   for(int i=0;i<totalSize;i++){
      pk[i] = zk[i];
   }
}

/*-------------------------------------------------------------------------*/
/*                          sk' * sk                                       */
/*-------------------------------------------------------------------------*/
dtype vecMulVec(dtype* sk)
{
   int totalSize = (num_cam*15)+(num_pt*3);
   dtype tmp = 0;

   for(int i=0;i<totalSize;i++){
      tmp += (sk[i]*sk[i]);
   }
   return tmp;
}

dtype vecMulVec(dtype* pk, dtype* Apk)
{
   int totalSize = (num_cam*15)+(num_pt*3);
   dtype tmp = 0;

   for(int i=0;i<totalSize;i++){
      tmp += (pk[i]*Apk[i]);
   }
   return tmp;
}

dtype vecMulVec(dtype* zk, dtype* rkp1, dtype* rk)
{
   int totalSize = (num_cam*15)+(num_pt*3);
   dtype tmp = 0;

   for(int i=0;i<totalSize;i++){
      tmp += (zk[i]*(rkp1[i]-rk[i]));
   }
   return tmp;
}

/*-------------------------------------------------------------------------*/
/*                             A * pk                                      */
/*-------------------------------------------------------------------------*/
void matMulVec(dtype* Apk, dtype* pk)
{
   int camId, ptId, apkId, wId, uId, vId, pId, Id; 
   //Apk of 2nd and 3rd section
   for(int i=0;i<num_proj;i++){
      camId = camidx[i]; ptId = ptidx[i];
      
      //first part: W * second half of pk
      apkId = camId*15; wId = i*45; 
      pId = (num_cam*15)+(ptId*3);
      for(int j=0;j<15;j++){
         Id = j*3;
         Apk[apkId+j]+=(valW[wId+Id]*pk[pId])+(valW[wId+Id+1]*pk[pId+1])+(valW[wId+Id+2]*pk[pId+2]);
      }

      //second part: W' * first half of pk
      apkId = (num_cam*15)+(ptId*3); 
      pId = camId*15;
      for(int j=0;j<3;j++){
         for(int k=0;k<15;k++){
            Id = (k*3)+j;
            Apk[apkId+j]+=(valW[wId+Id]*pk[pId+k]);
         }
      }  
   }

   //Apk of 1st section
   for(int i=0;i<num_cam;i++){   

      //U * first half of pk
      apkId = i*15; uId = i*225;
      for(int j=0;j<15;j++){
         for(int k=0;k<15;k++){
            Id = (j*15)+k;
            Apk[apkId+j]+=(U[uId+Id]*pk[apkId+k]);
         }
      }
   }

   //Apk of 4th section
   for(int i=0;i<num_pt;i++){
      
      //V * second half of pk
      apkId = (num_cam*15)+(i*3);
      vId = i*9;
      for(int j=0;j<3;j++){
         for(int k=0;k<3;k++){
            Id = (j*3)+k;
            Apk[apkId+j]+=(V[vId+Id]*pk[apkId+k]);
         }
      }
   }
} 

/*-------------------------------------------------------------------------*/
/*                          Apk Initialization                           */
/*-------------------------------------------------------------------------*/
void apkInitialization(dtype* Apk)
{
   int totalSize = (num_cam*15)+(num_pt*3);

   //Initialize to 0
   for(int i=0;i<totalSize;i++){
      Apk[i]=0.0;
   }
}

/*-------------------------------------------------------------------------*/
/*                    delta = delta + (alphak * pk)                        */
/*-------------------------------------------------------------------------*/
void updatedelta(dtype alphak, dtype* pk)
{
   int totalSize = (num_cam*15)+(num_pt*3);

   //delta = delta + (alphak * pk)
   for(int i=0;i<totalSize;i++){
      delta[i] = delta[i] + (alphak * pk[i]);
   }
}

/*-------------------------------------------------------------------------*/
/*                   rk = rk - (alphak * Apk)                              */
/*-------------------------------------------------------------------------*/
void updaterk(dtype* rk, dtype alphak, dtype* Apk)
{
   int totalSize = (num_cam*15)+(num_pt*3);

   //rk = rk - (alphak * Apk)
   for(int i=0;i<totalSize;i++){
      rk[i] = rk[i] - (alphak * Apk[i]);
   }
}

/*-------------------------------------------------------------------------*/
/*                   rk+1 = rk - (alphak * Apk)                              */
/*-------------------------------------------------------------------------*/
void updaterkp1(dtype* rkp1, dtype* rk, dtype alphak, dtype* Apk)
{
   int totalSize = (num_cam*15)+(num_pt*3);

   //rk+1 = rk - (alphak * Apk)
   for(int i=0;i<totalSize;i++){
      rkp1[i] = rk[i] - (alphak * Apk[i]);
   }
}

/*-------------------------------------------------------------------------*/
/*                  pk = sk + (betak * pk)                                 */
/*-------------------------------------------------------------------------*/
void updatepk(dtype* pk, dtype* rk, dtype* zk, dtype zktrk)
{
   int totalSize = (num_cam*15)+(num_pt*3);
   dtype betak = (vecMulVec(zk,rk))/zktrk;

   //pk = zk + (betak * pk)
   for(int i=0;i<totalSize;i++){
      pk[i] = zk[i] + (betak * pk[i]);
   }
}

void updatepk(dtype* pk, dtype* rkp1, dtype* rk, dtype* zk, dtype zktrk)
{
   int totalSize = (num_cam*15)+(num_pt*3);

   dtype betak = (vecMulVec(zk,rkp1,rk))/zktrk;

   //pk = zk + (betak * pk)
   for(int i=0;i<totalSize;i++){
      pk[i] = zk[i] + (betak * pk[i]);
   }
}

/*-------------------------------------------------------------------------*/
/*                            rk = rkp1                                    */
/*-------------------------------------------------------------------------*/
void copyrkp1Tork(dtype* rkp1, dtype* rk)
{
   int totalSize = (num_cam*15)+(num_pt*3);

   //rk = rkp1
   for(int i=0;i<totalSize;i++){
      rk[i] = rkp1[i];
   }
}

/*-------------------------------------------------------------------------*/
